<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ads Data Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th,
        td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>

<body>

    <h2>Ads Data Visualization</h2>

    <input type="file" id="csvFileInput" onchange="processData()">

    <h3>Weekly Breakdown</h3>
    <table id="weeklyResultsTable">
        <thead>
            <tr>
                <th>Week Date Range</th>
                <th>Ads Uploaded</th>
                <th>Visual Representation</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h3>Daily Breakdown</h3>
    <table id="dailyResultsTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Ads Uploaded</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        function processData() {
            const fileInput = document.getElementById('csvFileInput');
            const file = fileInput.files[0];

            if (!file) return;

            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    const data = results.data;

                    let adsCountByDate = {};
                    for (const row of data) {
                        const date = row['K'];
                        if (date) {
                            adsCountByDate[date] = (adsCountByDate[date] || 0) + 1;
                        }
                    }

                    displayDailyResults(adsCountByDate);
                    displayWeeklyResults(adsCountByDate);
                }
            });
        }

        function displayDailyResults(data) {
            const tableBody = document.getElementById('dailyResultsTable').querySelector('tbody');
            tableBody.innerHTML = '';

            const sortedDates = Object.keys(data).sort((a, b) => new Date(a) - new Date(b));
            for (const date of sortedDates) {
                const row = tableBody.insertRow();
                row.insertCell().textContent = formatDate(new Date(date));
                row.insertCell().textContent = data[date];
            }
        }

        function displayWeeklyResults(data) {
            const tableBody = document.getElementById('weeklyResultsTable').querySelector('tbody');
            tableBody.innerHTML = '';

            const sortedDates = Object.keys(data).sort((a, b) => new Date(a) - new Date(b));

            for (let i = 0; i < sortedDates.length; i += 7) {
                const weekStart = new Date(sortedDates[i]);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6);

                let adsUploadedThisWeek = 0;
                for (let j = 0; j < 7 && i + j < sortedDates.length; j++) {
                    adsUploadedThisWeek += data[sortedDates[i + j]];
                }

                const visualRepresentation = getVisualRepresentation(adsUploadedThisWeek);
                const row = tableBody.insertRow();
                row.insertCell().textContent = `${formatDate(weekStart)} - ${formatDate(weekEnd)}`;
                row.insertCell().textContent = adsUploadedThisWeek;
                row.insertCell().innerHTML = visualRepresentation;
            }
        }

        function formatDate(date) {
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            return `${months[date.getMonth()]} ${date.getDate()}`;
        }

        function getVisualRepresentation(count) {
            const colors = ['ðŸ”´', 'ðŸŸ¡', 'ðŸŸ¢', 'ðŸ”µ', 'ðŸŸ£', 'ðŸ”¶'];
            let representation = '';
            for (let i = 0; i < count && i < colors.length; i++) {
                representation += colors[i];
            }
            return representation;
        }
    </script>

</body>

</html>
