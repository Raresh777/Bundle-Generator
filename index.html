<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Upload Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        h2, h3, h4 {
            color: #333;
        }

        input[type="file"],
        button {
            padding: 10px 15px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #007BFF;
            color: #FFF;
        }

        table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
            background-color: #fff;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #333;
            color: #fff;
        }

        .bar {
            height: 20px;
            border-radius: 10px;
            position: relative;
            background-color: #eee;
        }

        .segment {
            height: 100%;
            float: left;
            background-color: #007BFF;
            transition: width 0.5s;
            border-radius: 10px 0 0 10px;
        }

        #publisherName {
            color: #007BFF;
        }

    </style>
</head>

<body>

<h2>Upload for <span id="publisherName"></span></h2>
<input type="file" id="upload" accept=".csv">
<button onclick="handleFile()">Analyze</button>

<h4><span id="monthName"></span> Breakdown</h4>
<p><strong>Total ads for the month:</strong> <span id="totalAds"></span></p>
<table id="weeklyBreakdown">
    <tr>
        <th>Week Date Range</th>
        <th>Ads Uploaded</th>
        <th>Visual Representation</th>
    </tr>
</table>
<p><strong>Day(s) with highest upload frequency:</strong> <span id="highFrequencyDays"></span></p>

<h4>Daily Breakdown</h4>
<table id="dailyBreakdownTable">
    <tr>
        <th>Day</th>
        <th>Percentage of Total Ads</th>
        <th>Visual Representation</th>
    </tr>
</table>

<script>
    function handleFile() {
        const file = document.getElementById('upload').files[0];
        Papa.parse(file, {
            complete: function (results) {
                analyzeData(results.data);
            }
        });
    }

    function analyzeData(data) {
        const publisherName = data[1][0];
        let validRows = data.slice(1).filter(row => row[10] && Date.parse(row[10]));
        let dates = validRows.map(row => new Date(row[10]));

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        document.getElementById('monthName').innerText = monthNames[dates[0].getMonth()];

        let weeklyData = {};
        dates.forEach(date => {
            let weekStart = startOfWeek(date);
            let weekEnd = endOfWeek(date);
            let weekKey = `${monthNames[weekStart.getMonth()]} ${weekStart.getDate()} - ${monthNames[weekEnd.getMonth()]} ${weekEnd.getDate()}`;
            weeklyData[weekKey] = (weeklyData[weekKey] || 0) + 1;
        });

        let dayCounts = {};
        dates.forEach(date => {
            let day = date.toLocaleString('en-US', { weekday: 'long' });
            dayCounts[day] = (dayCounts[day] || 0) + 1;
        });

        let maxDayCount = Math.max(...Object.values(dayCounts));
        let highFreqDays = Object.keys(dayCounts).filter(day => dayCounts[day] === maxDayCount);

        // Display results
        document.getElementById('publisherName').innerText = publisherName;
        document.getElementById('totalAds').innerText = validRows.length;

        let table = document.getElementById('weeklyBreakdown');
        let rowCount = table.rows.length;
        for (let i = rowCount - 1; i > 0; i--) {
            table.deleteRow(i);
        }

        Object.keys(weeklyData).forEach(week => {
            let row = table.insertRow(-1);
            let cell1 = row.insertCell(0);
            let cell2 = row.insertCell(1);
            let cell3 = row.insertCell(2);

            cell1.innerHTML = week;
            cell2.innerHTML = weeklyData[week];

            let bar = document.createElement('div');
            bar.className = 'bar';
            let segment = document.createElement('div');
            segment.className = 'segment';
            segment.style.width = (weeklyData[week] / validRows.length * 100) + '%';
            bar.appendChild(segment);
            cell3.appendChild(bar);
        });

        document.getElementById('highFrequencyDays').innerText = highFreqDays.join(', ');

        displayDailyBreakdown(validRows, dayCounts);
    }

    function displayDailyBreakdown(validRows, dayCounts) {
        // Calculate daily percentages
        let totalAdsCount = validRows.length;
        let dayPercentages = {
            'Saturday': (dayCounts['Saturday'] || 0) / totalAdsCount * 100,
            'Tuesday': (dayCounts['Tuesday'] || 0) / totalAdsCount * 100,
            'Thursday': (dayCounts['Thursday'] || 0) / totalAdsCount * 100
        };

        // Display daily percentages in a table with visual representation
        let table = document.getElementById('dailyBreakdownTable');
        
        // Remove previous rows
        let rowCount = table.rows.length;
        for (let i = rowCount - 1; i > 0; i--) {
            table.deleteRow(i);
        }
        
        // Add data to table
        Object.keys(dayPercentages).forEach(day => {
            let row = table.insertRow(-1);
            let cell1 = row.insertCell(0);
            let cell2 = row.insertCell(1);
            let cell3 = row.insertCell(2);

            cell1.innerHTML = day;
            cell2.innerHTML = `${dayPercentages[day].toFixed(2)}%`;

            let bar = document.createElement('div');
            bar.className = 'bar';
            let segment = document.createElement('div');
            segment.className = 'segment';
            segment.style.width = `${dayPercentages[day]}%`;
            bar.appendChild(segment);
            cell3.appendChild(bar);
        });
    }

    function startOfWeek(date) {
        let result = new Date(date);
        result.setDate(result.getDate() - result.getDay());
        return result;
    }

    function endOfWeek(date) {
        let result = new Date(date);
        result.setDate(result.getDate() + (6 - result.getDay()));
        return result;
    }

</script>
</body>

</html>
